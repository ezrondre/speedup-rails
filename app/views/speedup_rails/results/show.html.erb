<% info_class = 'additional_info' + ( @redirect ? "-#{@redirect}" : '' ) %>
<ul class="speedup_main_bar speedup_main_bar_<%= @redirect %><%= ' redirect' if @redirect %>">
  <% @collectors.each do |col| %>
    <% next unless col.render? %>
    <li>
      <span class="speedup_rails_<%= col.key %>" data-key="<%= col.key %>">
        <%= render "speedup_rails/collectors/#{col.key}", data: @request[col.key] || [], key: col.key %>
      </span>
    </li>
  <% end %>
</ul>
<div class="additional_info <%= info_class %>">
  <% if content_for?(:speed_up_additional_bars) %>
    <%= yield :speed_up_additional_bars %>
  <% end %>
</div>

<script type="text/javascript">
  elements = document.querySelectorAll("#speedup_rails_bar .speedup_main_bar_<%= @redirect %> > li > span");
  function handlerOver() {
    elem = document.querySelector('#speedup_rails_bar .<%= info_class %> .' + this.dataset.key );
    if( elem ) {
      elem.style.display = 'block';
      elem.style.bottom = '' + ( window.innerHeight - this.offsetParent.offsetTop + 2) + 'px';
    }
  }
  function handlerOut() {
    elem = document.querySelector('#speedup_rails_bar .<%= info_class %> .' + this.dataset.key );
    if( elem )
      elem.style.display = 'none';
  }
  for( i = 0; i < elements.length; ++i) {
    elements[i].onmouseover = handlerOver;
    elements[i].onmouseout = handlerOut;
  }
</script>
